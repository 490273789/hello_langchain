# v0.3 å’Œ v1.0å˜åŒ–

## LangChain v0.3 â†’ v1.0 ç‰ˆæœ¬å˜åŒ–æ€»ç»“

### ğŸ—ï¸ ä¸€ã€åŒ…ç»“æ„ç®€åŒ–

| å˜åŒ–ç‚¹ | v0.3 | v1.0 |
|--------|------|------|
| **å‘½åç©ºé—´** | åŒ…å«å¤§é‡æ¨¡å— | ç²¾ç®€ä¸º 5 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š`agents`ã€`messages`ã€`tools`ã€`chat_models`ã€`embeddings` |
| **é—ç•™ä»£ç ** | åœ¨ `langchain` åŒ…å†… | ç§»è‡³ `langchain-classic` åŒ… |
| **Python ç‰ˆæœ¬** | æ”¯æŒ Python 3.9+ | **æœ€ä½è¦æ±‚ Python 3.10+** |

éœ€è¦è¿ç§»åˆ° `langchain-classic` çš„åŠŸèƒ½ï¼š
- é—ç•™ Chainsï¼ˆ`LLMChain`ã€`ConversationChain` ç­‰ï¼‰
- Retrieversï¼ˆ`MultiQueryRetriever` ç­‰ï¼‰
- ç´¢å¼• APIï¼ˆIndexing APIï¼‰
- Hub æ¨¡å—

```python
# v0.3
from langchain.chains import LLMChain
from langchain.retrievers import MultiQueryRetriever

# v1.0
from langchain_classic.chains import LLMChain
from langchain_classic.retrievers import MultiQueryRetriever
```

---

### ğŸ¤– äºŒã€Agent åˆ›å»ºæ–¹å¼é‡å¤§å˜åŒ–

| å˜åŒ–ç‚¹ | v0.3 | v1.0 |
|--------|------|------|
| **å¯¼å…¥è·¯å¾„** | `langgraph.prebuilt.create_react_agent` | `langchain.agents.create_agent` |
| **å‡½æ•°å** | `create_react_agent` | `create_agent` |
| **æç¤ºè¯å‚æ•°** | `prompt` | `system_prompt` |

```python
# v0.3
from langgraph.prebuilt import create_react_agent
agent = create_react_agent(model, tools, prompt="...")

# v1.0
from langchain.agents import create_agent
agent = create_agent(
    model="claude-sonnet-4-5-20250929",
    tools=tools,
    system_prompt="You are a helpful assistant"
)
```

---

### âš™ï¸ ä¸‰ã€ä¸­é—´ä»¶ç³»ç»Ÿï¼ˆMiddlewareï¼‰- å…¨æ–°ç‰¹æ€§

v1.0 å¼•å…¥äº†å¼ºå¤§çš„ **Middleware ç³»ç»Ÿ**ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„é’©å­å‡½æ•°ï¼š

| v0.3 | v1.0 |
|------|------|
| `pre_model_hook` | `before_model` æ–¹æ³• |
| `post_model_hook` | `after_model` æ–¹æ³• |
| æ—  | `wrap_model_call`ã€`wrap_tool_call` |

**å†…ç½®ä¸­é—´ä»¶**ï¼š
- `PIIMiddleware` - æ•æ„Ÿä¿¡æ¯è„±æ•
- `SummarizationMiddleware` - å¯¹è¯å†å²æ‘˜è¦
- `HumanInTheLoopMiddleware` - äººå·¥å®¡æ‰¹

```python
from langchain.agents import create_agent
from langchain.agents.middleware import SummarizationMiddleware, HumanInTheLoopMiddleware

agent = create_agent(
    model="claude-sonnet-4-5-20250929",
    tools=tools,
    middleware=[
        SummarizationMiddleware(model="...", trigger={"tokens": 1000}),
        HumanInTheLoopMiddleware(interrupt_on={"send_email": {...}})
    ]
)
```

---

### ğŸ“¦ å››ã€çŠ¶æ€ç®¡ç†å˜åŒ–

| å˜åŒ–ç‚¹ | v0.3 | v1.0 |
|--------|------|------|
| **çŠ¶æ€ç±»å‹** | æ”¯æŒ Pydanticã€dataclassã€TypedDict | **ä»…æ”¯æŒ TypedDict** |
| **è¿è¡Œæ—¶ä¸Šä¸‹æ–‡** | `config["configurable"]` | `context` å‚æ•° |

```python
# v1.0 çŠ¶æ€å®šä¹‰
from langchain.agents import AgentState, create_agent

class CustomState(AgentState):  # å¿…é¡»ç»§æ‰¿ TypedDict
    user_id: str

agent = create_agent(model="...", tools=tools, state_schema=CustomState)

# è¿è¡Œæ—¶ä¸Šä¸‹æ–‡
result = agent.invoke(
    {"messages": [...]},
    context=Context(user_id="123")  # æ–°çš„ context å‚æ•°
)
```

---

### ğŸ“ äº”ã€æ ‡å‡†å†…å®¹å—ï¼ˆStandard Content Blocksï¼‰

v1.0 æ–°å¢ `content_blocks` å±æ€§ï¼Œæä¾›è·¨ä¾›åº”å•†çš„ç»Ÿä¸€æ¶ˆæ¯å†…å®¹è®¿é—®ï¼š

```python
response = model.invoke("Explain AI")

for block in response.content_blocks:
    if block["type"] == "reasoning":
        print(block.get("reasoning"))
    elif block["type"] == "text":
        print(block.get("text"))
    elif block["type"] == "tool_call":
        print(f"Tool: {block['name']}")
```

---

### ğŸ”§ å…­ã€ç»“æ„åŒ–è¾“å‡ºæ”¹è¿›

| å˜åŒ–ç‚¹ | v0.3 | v1.0 |
|--------|------|------|
| **ç”Ÿæˆä½ç½®** | å•ç‹¬èŠ‚ç‚¹ | ä¸»å¾ªç¯å†…ç”Ÿæˆï¼ˆå‡å°‘æˆæœ¬å’Œå»¶è¿Ÿï¼‰ |
| **ç­–ç•¥** | prompted output | `ToolStrategy`ã€`ProviderStrategy` |

```python
from langchain.agents.structured_output import ToolStrategy

agent = create_agent(
    model="gpt-4o-mini",
    tools=tools,
    response_format=ToolStrategy(OutputSchema)
)
```

---

### âš ï¸ ä¸ƒã€å…¶ä»–ç ´åæ€§å˜æ›´

1. **Chat Model è¿”å›ç±»å‹**ï¼šä» `BaseMessage` æ”¹ä¸º `AIMessage`
2. **`.text` è®¿é—®æ–¹å¼**ï¼šä»æ–¹æ³• `.text()` æ”¹ä¸ºå±æ€§ `.text`
3. **`AIMessage` çš„ `example` å‚æ•°è¢«ç§»é™¤**
4. **Anthropic é»˜è®¤ `max_tokens`**ï¼šä¸å†æ˜¯ 1024ï¼Œæ ¹æ®æ¨¡å‹è‡ªåŠ¨è®¾ç½®
5. **æµå¼èŠ‚ç‚¹åç§°**ï¼šä» `"agent"` æ”¹ä¸º `"model"`
6. **é¢„ç»‘å®šæ¨¡å‹**ï¼š`create_agent` ä¸å†æ¥å—é¢„ç»‘å®š tools çš„æ¨¡å‹

---

### ğŸ“Š æ€»ç»“å¯¹æ¯”è¡¨

| åŠŸèƒ½ | v0.3 | v1.0 |
|------|------|------|
| Python ç‰ˆæœ¬ | 3.9+ | **3.10+** |
| Agent åˆ›å»º | `create_react_agent` | `create_agent` |
| é’©å­å‡½æ•° | pre/post model hooks | Middleware ç³»ç»Ÿ |
| çŠ¶æ€ç±»å‹ | Pydantic/dataclass/TypedDict | ä»… TypedDict |
| å†…å®¹è®¿é—® | `message.content` | `message.content_blocks` |
| é—ç•™åŠŸèƒ½ | `langchain` | `langchain-classic` |
| ç»“æ„åŒ–è¾“å‡º | prompted output | Tool/Provider Strategy |